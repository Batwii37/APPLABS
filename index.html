<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GameStore Pro</title>
<style>
body { font-family: Arial; padding:20px; background:#111; color:white; }
.card { border:1px solid #444; padding:12px; margin-top:10px; border-radius:8px; }
input, button { padding:8px; margin:4px; }
button { cursor:pointer; }
</style>
</head>
<body>

<h1>ðŸŽ® GameStore Pro</h1>

<h2>Store</h2>
<button onclick="loadGames()">Refresh Store</button>
<div id="games"></div>

<hr>

<h2>Upload Game</h2>
<input id="title" placeholder="Game title"><br>
<input id="desc" placeholder="Description"><br>
<input id="price" placeholder="Price"><br>
<input id="email" placeholder="Your email"><br>
<input id="file" type="file"><br>
<button onclick="uploadGame()">Upload Game</button>
<div id="uploadStatus"></div>

<hr>

<h2>Admin Verification</h2>
<input id="adminEmail" placeholder="Admin email">
<button onclick="loadPending()">Load Pending</button>
<div id="pending"></div>

<script>
const API = "http://localhost:3000";

async function loadGames() {
  const res = await fetch(API + "/store");
  const games = await res.json();
  const el = document.getElementById("games");
  el.innerHTML = "";

  games.forEach(g => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<h3>${g.title}</h3><p>${g.description}</p><b>$${g.price}</b>`;
    el.appendChild(div);
  });
}

async function uploadGame() {
  const form = new FormData();
  form.append("title", document.getElementById("title").value);
  form.append("description", document.getElementById("desc").value);
  form.append("price", document.getElementById("price").value);
  form.append("developerEmail", document.getElementById("email").value);
  form.append("gameFile", document.getElementById("file").files[0]);

  const res = await fetch(API + "/upload-game", {
    method: "POST",
    body: form
  });

  const data = await res.json();
  document.getElementById("uploadStatus").innerText =
    "Uploaded. Game ID: " + data.gameId;
}

async function loadPending() {
  const res = await fetch(API + "/pending");
  const games = await res.json();
  const adminEmail = document.getElementById("adminEmail").value;
  const el = document.getElementById("pending");
  el.innerHTML = "";

  games.forEach(g => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h3>${g.title}</h3>
      <button onclick="verifyGame('${g.id}', '${adminEmail}')">Verify</button>
    `;
    el.appendChild(div);
  });
}

async function verifyGame(id, email) {
  await fetch(API + "/verify-game/" + id, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });
  loadPending();
  loadGames();
}
</script>

</body>
</html>
